#!/usr/bin/env bash
set -e

SCRIPT_PATH=$( cd "$(dirname "${BASH_SOURCE[0]}")"; pwd -P )
cd ${SCRIPT_PATH}/..


printf "\n\n-------- file=file.zig --------\n"
./bin/compile_file_zig.sh

printf "\n\n-------- file=play.zig --------\n"
./bin/compile_play_zig.sh

printf "\n\n-------- docker image --------\n"
DATESTAMP=$(date +"%y%m%d")
GITSTAMP=$(git rev-parse --short HEAD)

cat << EOF > ./web/doc/version.js
// generated by build.sh
window.ZigRun = window.ZigRun || {};
window.ZigRun.build = '${DATESTAMP}';
window.ZigRun.commit = '${GITSTAMP}';
EOF

sudo docker build \
    --tag zig.run:local \
    -f ./Dockerfile
